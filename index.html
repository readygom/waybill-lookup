<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì˜¬ë¦¼í”¼ì•„ë“œ êµì¬ ìš´ì†¡ì¥ ì¡°íšŒ</title>
  
<!-- ê³µìœ  ë¯¸ë¦¬ë³´ê¸°ìš© ë©”íƒ€ íƒœê·¸ -->
<meta name="description" content="ì´ë¦„ì´ë‚˜ ì—°ë½ì²˜ë¡œ ìš´ì†¡ì¥ ë²ˆí˜¸ë¥¼ ë¹ ë¥´ê²Œ í™•ì¸í•˜ì„¸ìš”." />
<meta property="og:title" content="ì˜¬ë¦¼í”¼ì•„ë“œ êµì¬ ìš´ì†¡ì¥ ì¡°íšŒ ì„œë¹„ìŠ¤" />
<meta property="og:description" content="ì´ë¦„ì´ë‚˜ ì—°ë½ì²˜ë¡œ ìš´ì†¡ì¥ ë²ˆí˜¸ë¥¼ ë¹ ë¥´ê²Œ í™•ì¸í•˜ì„¸ìš”." />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://readygom.github.io/waybill-lookup/" />
<meta property="og:site_name" content="ì˜¬ë¦¼í”¼ì•„ë“œ" />
<meta property="og:locale" content="ko_KR" />

  <style>
    :root{
      --bg:#0b1220;
      --bg2:#0f172a;
      --card:#111827;
      --muted:#94a3b8;
      --text:#e5e7eb;
      --brand:#06b6d4;
      --accent:#f59e0b;
      --ring: rgba(6, 182, 212, .35);
      --radius: 16px;
    }
    *{box-sizing:border-box}
    body{margin:0; background:linear-gradient(180deg,var(--bg),var(--bg2)); color:var(--text); font-family:ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", Helvetica, Arial, "Apple SD Gothic Neo", "Malgun Gothic", "Nanum Gothic", "Apple Color Emoji", "Segoe UI Emoji";}
    .wrap{max-width:1024px; margin:40px auto; padding:0 20px}
    header{display:flex; gap:16px; align-items:center; margin-bottom:20px}
    .logo{width:40px; height:40px; border-radius:10px; background:radial-gradient(120% 120% at 20% 20%, var(--brand), #2563eb); box-shadow:0 10px 30px rgba(6,182,212,.35)}
    h1{font-size:24px; margin:0}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.015)); border:1px solid rgba(255,255,255,.08); border-radius:var(--radius); padding:20px; box-shadow:0 10px 35px rgba(0,0,0,.35)}
    .hint{color:var(--muted); font-size:14px}
    .input{width:100%; padding:14px 14px; border-radius:12px; background:#0b1220; color:var(--text); border:1px solid rgba(255,255,255,.12); outline:none}
    .input:focus{border-color:var(--brand); box-shadow:0 0 0 6px var(--ring)}
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .btn{appearance:none; border:none; border-radius:12px; padding:12px 16px; background:var(--brand); color:#042f2e; font-weight:700; cursor:pointer}
    .btn.ghost{background:transparent; border:1px solid rgba(255,255,255,.15); color:var(--text)}
    .btn:disabled{opacity:.5; cursor:not-allowed}
    .result{display:grid; gap:12px; margin-top:14px}
    .item{display:flex; flex-wrap:wrap; gap:10px; justify-content:space-between; align-items:center; background:#0b1220; border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:14px}
    .item strong{font-size:16px}
    .tag{font-size:12px; color:var(--muted)}
    .carrier{font-weight:700; color:var(--accent)}
    a.link{color:#93c5fd; text-decoration:none}
    a.link:hover{text-decoration:underline}
    .kbd{font-family:ui-monospace,monospace; background:#0b1220; border:1px solid rgba(255,255,255,.12); padding:2px 6px; border-radius:6px}
    footer{margin:28px 0; text-align:center; color:var(--muted); font-size:12px}
    .small-hint {font-size: 12px; color: var(--muted);}
    
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo" aria-hidden></div>
      <div>
        <h1>ì˜¬ë¦¼í”¼ì•„ë“œ êµì¬ ìš´ì†¡ì¥ ì¡°íšŒ</h1>
        <div class="hint">ì´ë¦„ ë˜ëŠ” ì—°ë½ì²˜ë¡œ ê²€ìƒ‰í•˜ë©´ ìš´ì†¡ì¥ ë²ˆí˜¸ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>
      </div>
    </header>

    <section class="card">
      <label for="q" class="hint">ê²€ìƒ‰ì–´</label>
      <div class="row" style="margin-top:6px">
        <input id="q" class="input" placeholder="ì˜ˆ: í™ê¸¸ë™ ë˜ëŠ” 01012345678" />
        <button id="btnSearch" class="btn">ì¡°íšŒ</button>
        <button id="btnRefresh" class="btn ghost" title="êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ìƒˆë¡œ ë¶ˆëŸ¬ì˜¤ê¸°">ìµœì‹  ì¶œê³ ë‚´ì—­ ì—…ë°ì´íŠ¸</button>
        <div class="small-hint" style="margin-top:4px;">ğŸ“Œ "ìµœì‹  ì¶œê³ ë‚´ì—­ ì—…ë°ì´íŠ¸" ë²„íŠ¼ì„ ëˆ„ë¥¸ í›„ ì¡°íšŒ í•´ì£¼ì„¸ìš”!</div>

        
      </div>
      <div id="stats" class="hint" style="margin-top:6px"></div>
      <div id="result" class="result"></div>
    </section>

    <footer>Â© <span id="year"></span> ì˜¬ë¦¼í”¼ì•„ë“œ êµì¬ ìš´ì†¡ì¥ ê°„í¸ ì¡°íšŒ</footer>
  </div>

  <script>
    const CONFIG = {
      mode: 'csv',
      csvUrl: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT0AhuyvpRKGxCw1pH3wDGYGmFPgJPV5og1m3jLJByUBzjmLJVG1QhKHoKTpQTsCWIqZWTp2Ox71go3/pub?output=csv',
      appsScriptUrl: ''
    };

    let DB = [];
    const $ = (q)=>document.querySelector(q);
    (document.querySelector('#year')||{}).textContent = new Date().getFullYear();

    // ===== Helpers =====
    const CARRIER_LINKS = {
      'CJëŒ€í•œí†µìš´': (no) => `https://track.cjlogistics.com/ko/tracking?slipno=${encodeURIComponent(no)}`,
      'í•œì§„íƒë°°': (no) => `https://www.hanjin.co.kr/kor/CMS/DeliveryMgr/WaybillResult.do?mCode=MN038&schLang=KR&billno=${encodeURIComponent(no)}`,
      // ìš”ì²­: ë¡¯ë°íƒë°°ëŠ” í•­ìƒ ê³ ì • íŠ¸ë˜í‚¹ í˜ì´ì§€ë¡œ ì´ë™
      'ë¡¯ë°íƒë°°': () => 'https://www.lotteglogis.com/home/reservation/tracking/index',
      'ë¡œì  íƒë°°': (no) => `https://www.ilogen.com/web/personal/trace/${encodeURIComponent(no)}`,
      'ìš°ì²´êµ­íƒë°°': (no) => `https://service.epost.go.kr/trace.RetrieveDomRigiTraceList.comm?sid1=${encodeURIComponent(no)}`,
    };
    const looksLikeValidUrl = (u)=> typeof u==='string' && u.startsWith('http') && u.length>12;
    const normalizePhone = (s)=> String(s||'').replace(/\D/g,'');

    // ===== View =====
    function maskPhone(phone){
const digits = String(phone||'');
if(digits.length < 4) return digits;
return digits.slice(0, -4) + '****';
}


    function render(items){
      const result = $('#result');
      result.innerHTML = '';
      if(!items.length){
        result.innerHTML = `<div class="hint">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
        return;
      }const normalizePhone = (s)=> String(s||'').replace(/\D/g,'');
      for(const it of items){
        let no = it.tracking_no||'';
        let carrier = it.carrier||'';
        // ìš´ì†¡ì¥ ë²ˆí˜¸ë§Œ ìˆê³  íƒë°°ì‚¬ ë¹„ì–´ìˆìœ¼ë©´ ê¸°ë³¸ì„ ë¡¯ë°íƒë°°ë¡œ ì„¤ì •
        if(no && !carrier){
          carrier = 'ë¡¯ë°íƒë°°';
        }
        const link = no ? (CARRIER_LINKS[carrier] ? CARRIER_LINKS[carrier](no) : `https://www.google.com/search?q=${encodeURIComponent((carrier||'ìš´ì†¡ì¥')+' '+no)}`) : '';
        const el = document.createElement('div');
        el.className = 'item';
        el.innerHTML = `
          <div>
            <strong>${it.receiver||'-'}</strong>
            <div class="tag">ì—°ë½ì²˜: ${maskPhone(it.phone)||'-'}</div>
            ${it.shop ? `<div class="tag">ì„œì ëª…: ${it.shop}</div>`:''}
            ${it.date ? `<div class="tag">ì¶œê³ ì¼ì: ${it.date}</div>`:''}
            <div class="tag">ì£¼ì†Œ: ${it.address||'-'}</div>
            <div class="tag">ë¹„ê³ : ${it.note||'-'}</div>
          </div>
          <div style="text-align:right">
            <div class="carrier">${carrier||'íƒë°°ì‚¬ ë¯¸ì§€ì •'}</div>
            <div class="carrier">ìš´ì†¡ì¥: ${no||'-'}</div>

            ${no ? `<a class="link" href="${link}" target="_blank" rel="noopener">íƒë°°ì‚¬ì—ì„œ ì¡°íšŒí•˜ê¸° â†’</a>` : `<span class="hint">ìš´ì†¡ì¥ ì¤€ë¹„ì¤‘</span>`}
          </div>`;
        result.appendChild(el);
      }
    }

    // ===== Search =====
    function filterRecords(records, q){
      const f = (q||'').trim().toLowerCase();
      if(!f) return [];
      const fnum = normalizePhone(q);
      return (records||[]).filter(r=>{
        const byName = String(r.receiver||'').toLowerCase().includes(f);
        const byPhone = normalizePhone(r.phone).includes(fnum) && fnum.length>0;
        return byName || byPhone;
      });
    }
    function search(){
      const q = $('#q').value;
      const out = filterRecords(DB, q);
      render(out);
      $('#stats').textContent = q.trim()? `${out.length}ê±´ì´ ê²€ìƒ‰ë˜ì—ˆìŠµë‹ˆë‹¤.` : '';
    }
    $('#btnSearch').addEventListener('click', search);
    $('#q').addEventListener('keydown', e=>{ if(e.key==='Enter') search(); });

    // ===== CSV utils =====
    function parseCSV(text){
      const rows = [];
      let i=0, field='', row=[], inQuotes=false;
      while(i<text.length){
        const c = text[i];
        if(c==='"'){
          if(inQuotes && text[i+1]==='"'){ field+='"'; i++; }
          else inQuotes = !inQuotes;
        }else if(c===',' && !inQuotes){ row.push(field); field=''; }
        else if((c==='\n' || c==='\r') && !inQuotes){ if(field!==''||row.length){ row.push(field); rows.push(row); row=[]; field=''; } }
        else{ field+=c; }
        i++;
      }
      if(field!==''||row.length) { row.push(field); rows.push(row); }
      return rows.filter(r=>r.length>1);
    }

    function rowsToDB(rows){
      if(!rows||!rows.length) return [];
      // í—¤ë” ì •ê·œí™”: BOM ì œê±°, ê³µë°±/ëŒ€ì†Œë¬¸ì ë¬´ì‹œ, ìœ ì‚¬ëª… í—ˆìš©
      const header = rows.shift().map(h=>String(h).replace(/\uFEFF/g,'').trim());
      const norm = (s)=> String(s||'').replace(/\s/g,'').toLowerCase();
      const find = (key, ...alts)=>{
        const keys = [key, ...alts];
        for(const k of keys){
          const i = header.findIndex(h=> norm(h) === norm(k));
          if(i>-1) return i;
        }
        return -1;
      };
      const idx = {
        receiver: find('ë°›ëŠ”ì‚¬ëŒ','ìˆ˜ë ¹ì¸','ì´ë¦„'),
        phone:    find('ì—°ë½ì²˜','ì „í™”ë²ˆí˜¸','íœ´ëŒ€í°'),
        address:  find('ì£¼ì†Œ','ë°°ì†¡ì§€'),
        note:     find('ë¹„ê³ ','ë©”ëª¨'),
        tracking_no: find('ìš´ì†¡ì¥ë²ˆí˜¸','ìš´ì†¡ì¥','ì†¡ì¥','ì†¡ì¥ë²ˆí˜¸'),
        carrier:  find('íƒë°°ì‚¬','ë°°ì†¡ì—…ì²´','carrier'),
        date:     find('ì¶œê³ ì¼ì','ì¶œê³ ì¼','date'),
        shop:     find('ì„œì ëª…','ì„œì ','ë§¤ì¥','shop','store')
      };
      return rows.map(r=>({
        receiver: r[idx.receiver]||'',
        phone: r[idx.phone]||'',
        address: r[idx.address]||'',
        note: r[idx.note]||'',
        tracking_no: r[idx.tracking_no]||'',
        carrier: idx.carrier>=0? r[idx.carrier]||'': '',
        date: idx.date>=0? r[idx.date]||'': '',
        shop: idx.shop>=0? r[idx.shop]||'': ''
      })).filter(x=> x.receiver || x.phone || x.tracking_no);
    }

    async function fetchCSV(url){
      const res = await fetch(url, { cache:'no-store' });
      if(!res.ok) throw new Error(`CSV fetch failed: ${res.status}`);
      const text = await res.text();
      return rowsToDB(parseCSV(text));
    }

    async function loadData(){
      try{
        if(CONFIG.mode==='csv' && !looksLikeValidUrl(CONFIG.csvUrl)) return;
        DB = await fetchCSV(CONFIG.csvUrl);
        render([]);
      }catch(err){
        console.error(err);
      }
    }

    $('#btnRefresh').addEventListener('click', loadData);
    // ì´ˆê¸° ìë™ ë¡œë“œ: GitHub Pages(ì‹¤ì„œë¹„ìŠ¤)ì—ì„œë§Œ ìë™ìœ¼ë¡œ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
    const isProd = /github\.io$/.test(location.hostname);
    if (isProd) {
      if (document.readyState==='complete' || document.readyState==='interactive') {
        loadData();
      } else {
        document.addEventListener('DOMContentLoaded', loadData);
      }
    }

    // ê°„ë‹¨ í…ŒìŠ¤íŠ¸ (ê°œë°œì í™•ì¸ìš©)
    (function runTests(){
      const out=[]; let pass=0, fail=0; const log=(ok,msg)=>{ ok?pass++:fail++; out.push(`${ok?'âœ…':'âŒ'} ${msg}`); };
      (function(){ const csv='ë°›ëŠ”ì‚¬ëŒ,ì—°ë½ì²˜\n"ê¹€,ê°€ì€",010-1234\n'; const rows=parseCSV(csv); log(rows.length===2 && rows[1][0]==='ê¹€,ê°€ì€','T1 parseCSV quoted comma'); })();
      (function(){ const rows=[["ë°›ëŠ”ì‚¬ëŒ","ì—°ë½ì²˜","ì£¼ì†Œ","ë¹„ê³ ","ìš´ì†¡ì¥ë²ˆí˜¸","íƒë°°ì‚¬"],["í™ê¸¸ë™","010-0000-0000","ì„œìš¸","ë©”ëª¨","0099","CJëŒ€í•œí†µìš´"]]; const db=rowsToDB(rows); log(db.length===1 && db[0].tracking_no==='0099' && db[0].carrier==='CJëŒ€í•œí†µìš´','T2 rowsToDB map'); })();
      (function(){ const db=[{receiver:'ê¹€ê°€ì€',phone:'010-1234-5678'},{receiver:'ë°•ë¯¼ìˆ˜',phone:'010-9999-0000'}]; const a=filterRecords(db,'ê¹€'); const b=filterRecords(db,'9999'); log(a.length===1 && a[0].receiver==='ê¹€ê°€ì€','T3-1 name includes'); log(b.length===1 && b[0].receiver==='ë°•ë¯¼ìˆ˜','T3-2 phone partial'); })();
      console.log(out.join('\n'), `\nê²°ê³¼: ${pass} PASS / ${fail} FAIL`);
    })();
  </script>
</body>
</html>

